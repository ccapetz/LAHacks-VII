<!DOCTYPE html>
<html lang="en">

<head>
    <title>Survey</title>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- import the webpage's stylesheet -->
    <link rel="stylesheet" href="surveyStyle.css" />
</head>

<body>
    <div class="header">
        <div class="navigation-links">
            <div><a href="home.html">Home</a></div>
            <div><a href="hurricanesurvey.html">Damage Survey</a></div>
        </div>
    </div>
    <div class="container">
        <form id="myForm" enctype="multipart/form-data">
            <input type="file" id="input">
            <button type="button" onclick="uploadFile()">Upload</button>
        </form>
        <script>
            var fileInput = document.getElementByID("input")
            var file = fileInput.files[0];
            var formData = new FormData();
            formData.append("file", file);
            var xhr = new XMLHttpRequest();
            xhr.open("POST", "/74.207.251.96:5002", true);
            xhr.onload = function () {
                if (xhr.status === 201) {
                    console.log(xhr.responseText);
                    let getRequest = XMLHttpRequest();
                    getRequest.open("GET", "/74.207.251.96:5002", true);
                    getRequest.responseType = "blob";
                    getRequest.onload = function () {
                        if (getRequest.status() == 200) {
                            var b = new Blob([getRequest.response], { type: 'image/png' });
                            downloadBlob(b, "image.png");
                        }
                    }
                } else {
                    console.log("Error:", xhr.statusText);
                }
            };
            xhr.send(formData);
            //POST done

            function downloadBlob(blob, name = 'file.txt') {
                // Convert your blob into a Blob URL (a special url that points to an object in the browser's memory)
                const blobUrl = URL.createObjectURL(blob);

                // Create a link element
                const link = document.createElement("a");

                // Set link's href to point to the Blob URL
                link.href = blobUrl;
                link.download = name;

                // Append link to the body
                document.body.appendChild(link);

                // Dispatch click event on the link
                // This is necessary as link.click() does not work on the latest firefox
                link.dispatchEvent(
                    new MouseEvent('click', {
                        bubbles: true,
                        cancelable: true,
                        view: window
                    })
                );

                // Remove link from body
                document.body.removeChild(link);
            }


        </script>
    </div>
</body>

</html>